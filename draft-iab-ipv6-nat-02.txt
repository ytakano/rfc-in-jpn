


Network Working Group                                          D. Thaler
Internet-Draft                                                 Microsoft
Intended status: Informational                                  L. Zhang
Expires: April 29, 2010                                             UCLA
                                                             G. Lebovitz
                                                                 Juniper
                                                        October 26, 2009


            IAB Thoughts on IPv6 Network Address Translation
                       draft-iab-ipv6-nat-02.txt

Status of this Memo

   This Internet-Draft is submitted to IETF in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on April 29, 2010.

Copyright Notice

   Copyright (c) 2009 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents in effect on the date of
   publication of this document (http://trustee.ietf.org/license-info).
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.






Thaler, et al.           Expires April 29, 2010                 [Page 1]

Internet-Draft           IPv6 NAT Considerations            October 2009


Abstract

   There has been much recent discussion on the topic of whether the
   IETF should develop standards for IPv6 Network Address Translators
   (NATs).  This document articulates the architectural issues raised by
   IPv6 NATs, the pros and cons of having IPv6 NATs, and provides the
   IAB's thoughts on the current open issues and the solution space.


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.  What is the Problem? . . . . . . . . . . . . . . . . . . . . .  3
     2.1.  Avoiding Renumbering . . . . . . . . . . . . . . . . . . .  4
     2.2.  Site Multihoming . . . . . . . . . . . . . . . . . . . . .  4
     2.3.  Network Obfuscation  . . . . . . . . . . . . . . . . . . .  5
       2.3.1.  Hiding Hosts . . . . . . . . . . . . . . . . . . . . .  5
     2.4.  Topology Hiding  . . . . . . . . . . . . . . . . . . . . .  8
     2.5.  Summary Regarding NAT as a Tool for Network Obfuscation  .  8
     2.6.  Simple Security  . . . . . . . . . . . . . . . . . . . . .  9
     2.7.  Discussion . . . . . . . . . . . . . . . . . . . . . . . .  9
   3.  Architectural Considerations of IPv6 NAT . . . . . . . . . . .  9
   4.  Solution Space . . . . . . . . . . . . . . . . . . . . . . . . 11
     4.1.  Discussion . . . . . . . . . . . . . . . . . . . . . . . . 12
   5.  Security Considerations  . . . . . . . . . . . . . . . . . . . 13
   6.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 13
   7.  IAB Members at the time of this writing  . . . . . . . . . . . 13
   8.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 13
     8.1.  Normative References . . . . . . . . . . . . . . . . . . . 13
     8.2.  Informative References . . . . . . . . . . . . . . . . . . 13
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 14




















Thaler, et al.           Expires April 29, 2010                 [Page 2]

Internet-Draft           IPv6 NAT Considerations            October 2009


1.  Introduction

1.  イントロダクション

   In the past, the IAB has published a number of documents relating to
   Internet transparency and the end-to-end principle, and other IETF
   documents have also touched on these issues as well.  These documents
   articulate the general principles on which the Internet architecture
   is based, as well as the core values that the Internet community
   seeks to protect going forward.  Most recently, RFC 4924 [RFC4924]
   reaffirms these principles and provides a review of the various
   documents in this area.

   過去，IABはインターネットの透明性とend-to-endの原則に関連したドキュメントを数
   多く発表してきた．さらに，他のIEFTのドキュメントも同様に，この問題点に触れて 
   きた．これらのドキュメントは，インターネットアーキテクチャが基づいている一般
   的な原理を言い表しており，同様に，インターネットコミュニティが将来に渡って努
   めて守るべきの核となる価値基準を示している．

   Facing imminent IPv4 address space exhaustion, recently there have
   been increased efforts in IPv6 deployment.  However, since late last
   year there have also been increased discussions about whether the
   IETF should standardize network address translation within IPv6.
   People who are against standardizing IPv6 NAT argue that there is no
   fundamental need for IPv6 NAT, and that as IPv6 continues to roll
   out, the Internet should converge towards reinstallation of the end-
   to-end reachability which has been a key factor in the Internet's
   success.  On the other hand, people who are for IPv6 NAT believe that
   NAT vendors would provide IPv6 NAT implementations anyway as NAT can
   be a solution to a number of problems, and that the IETF should avoid
   repeating the same mistake as with IPv4 NAT, where the lack of
   protocol standards led to different IPv4 NAT implementations, making
   NAT traversal difficult.

   切迫したIPv4アドレス枯渇問題に直面し，最近ではIPv6の普及努力が喚起されてい
   る．しかしながら，ここ数年ほど前から，IETFはIPv6のためのネットワークアドレス
   変換を標準化すべきかという議論も増えてきている．IPv6 NATの標準化に反対する
   人々は，基本的にIPv6にはNATが必要ないと述べ，さらに，IPv6がロールアウトし続け
   るのに従い，インターネットは，インターネットが大成功を収める鍵となった
   end-to-endの接続性を，再び取り戻す方向へ向かうべきであるとしている．その一
   方，IPv6 NATに賛成する人々は，いずれにせよ，NATが多くの問題を解決することが出
   来るので，NATベンダはIPv6 NATを搭載した機器をリリースするだろうと信じている
   し，さらに，IETFは，IPv4 NATで起きたような同様の過ちを繰り返すことを避けるべ
   きだとしている．IPv4 NATの場合，そのプロトコル標準の不完全さのため種々の実装
   が登場しNAT越えが困難になってしまった．

   An earlier effort, [RFC4864], provides a discussion of the real or
   perceived benefits of NAT and suggests alternatives for most of them,
   with the intent of showing that NAT is not required to get the
   desired benefits.  However, it also identifies several gaps remaining
   to be filled.

   以前の成果[RFC4864]では，現実的に知られているNATの利点について議論を行い，そ
   の上で，NATは望んだ利益を得るために必要でないと示すために，NATの代替手段を提
   案している．しかしながら，そこでは同様に，幾つかの埋めるべきギャップが残され
   ていると判断している．

   This document provides the IAB's current thoughts on this debate.  We
   believe that the issue at hand must be viewed from an overall
   architectural standpoint in order to fully assess the pros and cons
   of IPv6 NAT on the global Internet and its future development.

   このドキュメントは，この論争についての現時点におけるIABの見解を示すものであ
   る．我々は，この文書は近い将来に，アーキテクチャ全般の視点から，グローバルイ
   ンターネットにおけるIPv6 NATの賛否の判断と，将来の開発のために参照されるべき
   であると信じている．


2.  What is the Problem?

2.  問題は何か？

   The discussions on the desire for IPv6 NAT can be summarized as
   follows.  Network address translation is viewed as a solution to
   achieve a number of desired properties for individual networks:
   avoiding renumbering, facilitating multihoming, internal topology
   hiding, preventing host counting, and simple security.  We discuss
   below each of these perceived benefits from NAT.

   IPv6 NATへの要求に関する議論は以下に要約される，ネットワークアドレス変換は個
   々のネットワークにおいて多くの望ましい特性を得るための解決方法と見なされる．
   つなり，IPv6 NATは，アドレス再設定の回避，マルチホーミングの容易化，内部トポ
   ロジの隠蔽，ホスト走査からの防御，単純なセキュリティなどを可能とするとされ
   る．我々は以下で，これらのNATから得られるとされている利益について議論を行う．
   



Thaler, et al.           Expires April 29, 2010                 [Page 3]

Internet-Draft           IPv6 NAT Considerations            October 2009


2.1.  Avoiding Renumbering

2.1.  アドレス再設定の回避

   As discussed in [RFC4864] Section 2.5, the ability to change service
   providers with minimal operational difficulty is an important
   requirement in many networks.  However, renumbering is still quite
   painful today, as discussed in [I-D.carpenter-renum-needs-work].
   Currently it requires reconfiguring devices that deal with IP
   addresses or prefixes, including DNS servers, DHCP servers,
   firewalls, IPsec policies, and potentially many other systems such as
   intrusion detection systems, inventory management systems, patch
   management systems, etc.

   [RFC4864]の2.5節によると，最小限の作業でサービスプロバイダを変更出来ること
   は，多くのネットワークにとって重要な要求である．しかしながら，アドレスの再割
   り当ては，[I-D.carpenter-renum-needs-work]で議論されているように，今日でも非
   常に骨の折れる作業である．現状，プロバイダの変更を行うと，IPアドレスやプレ
   フィクス扱うデバイス，つまり，DNSサーバ，DHCPサーバ，ファイアウォール，IPSec
   のポリシや，さらには，もしかすると侵入検知システム，在庫管理システム，パッチ
   管理システム等まで，多くのシステムの再設定を行わなければならい．

   In practice today, renumbering does not seem to be a significant
   problem in consumer networks, such as home networks, where addresses
   or prefixes are typically obtained through DHCP, and are rarely
   manually configured in any component.  However in managed networks,
   renumbering can be a serious problem.

   今日では，実際のところ，ホームネットワークなどDHCPによってアドレスやプレフィ
   クスが配布され，手動で設定を行うことが非常にまれであるようなコンシューマネッ
   トワークでは，アドレス再設定は重大な問題ではないように思われる．しかしなが
   ら，マネージドネットワークでは，アドレス再設定は重大な問題となりうる．

   We also note that many, if not most, large enterprise networks avoid
   the renumbering problem by using provider-independent (PI) IP address
   blocks.  The use of PI addresses is inherent in today's Internet
   operations.  However in smaller managed networks that cannot get
   provider-independent IP address blocks, renumbering remains a serious
   issue.  Regional Internet Registries (RIRs) constantly receive
   requests for PI address blocks; one main reason that they hesitate in
   assigning PI address blocks to all users is the concern about the PI
   addresses' impact on the routing system scalability.

   同様に，全てとは言えないまでにしても，たくさんの大きなエンタープライズネット
   ワークはプロバイダ独立アドレス(PIアドレス)のIPアドレス部六を利用することで，
   アドレス再設定を避けていることは，特筆すべき点である．PIアドレスの利用は現在
   のインターネットオペレーション固有のものである．しかしながら，より小さな．PI
   アドレスブロックを取得できないようなマネージドネットワークでは，アドレス再設
   定は依然として重大な問題である．地域インターネットレジストリ(RIRs)は絶えずPI
   アドレスブロックの申請を受けている．この主たる理由の一つとして，RIRsが，全て
   のユーザへPIアドレスブロックを割り当てることは，ルーティングシステムの規模追
   従性に影響を与える事を懸念して，PIアドレスの割り当てを躊躇しているという事実
   が挙げられる．

2.2.  Site Multihoming

2.2.  サイトマルチホーミング

   Another important requirement in many networks is site multihoming.
   A multihomed site essentially requires that its IP prefixes be
   present in the global routing table to achieve the desired
   reliability in its Internet connectivity as well as load balancing.
   In today's practice, multihomed sites with PI addresses announce
   their PI prefixes to the global routing system; multihomed sites with
   provider-allocated (PA) addresses also announce the PA prefix they
   obtained from one service provider to the global routing system
   through another service provider, effectively disabling provider-
   based prefix aggregation.  This practice makes the global routing
   table scale linearly with the number of multihomed user networks.

   多くのネットワークにおいて，もう一つの重要な要求はサイトマルチホーミングであ
   る．マルチホームされたサイトは本質的に，負荷分散に加え，目的とするインター
   ネット接続の信頼性を達成するために，そのIPプレフィクスがグローバルなルーティ
   ングテーブルに存在することを要求する．今日の実情は，PIアドレスを持つマルチホ
   ームされたサイトは，自身のPIアドレスをグローバルなルーティングシステムにアナ
   ウンスする．サービスプロバイダから得たプロバイダ集約アドレス(PAアドレス)を持
   つ，マルチホームされたサイトは，同様にPAプレフィクスもグローバルなルーティン
   グシステムにアナウンスする．事実上，これらはプロバイダベースでのプレフィクス
   集約を無効としてしまう．この習慣によって，グローバルなルーティングテーブルの
   大きさは，マルチホームされたユーザネットワークの数に比例するようになる．

   This issue was identified in [RFC4864] Section 6.4.  Unfortunately,
   no solution except NAT has been deployed today that can insulate the
   global routing system from the growing number of multihomed sites,
   where a multihomed site simply assigns multiple IPv4 addresses, one
   from each of its service providers, to its exit router which is an
   IPv4 NAT box.  Using address translation to facilitate multihoming



Thaler, et al.           Expires April 29, 2010                 [Page 4]

Internet-Draft           IPv6 NAT Considerations            October 2009


   support has one unique advantage: there is no impact on the routing
   system scalability, as the NAT box simply takes one address from each
   service provider, and the multihomed site does not inject its own
   routes into the system.  Intuitively it also seems straightforward to
   roll the same solution into multihoming support in the IPv6
   deployment.

   この問題は[RFC4864]の6.4節で指摘されている．残念なことに，マルチホームされた
   サイト数の増加に伴うグローバルなルーティングテーブルの肥大化を防ぐ唯一の解決
   方法は，今日広まっている，NATを用いる方法のみである．ただし，マルチホームされ
   たサイトは，単純に，サービスプロバイダから取得した複数のIPv4アドレスを出口
   ルータである，単一のIPv4 NAT箱に割り当てると想定する．マルチホームを容易にす
   るためにアドレス変換を利用することは，利点がある．つまり，NATを用いたマルチ
   ホームは，ルーティングテーブルの規模追従性に悪影響を及ぼさない．NAT箱は，単純
   にそれぞれのサービスプロバイダから一つのアドレスを貰えばいいのである．従っ
   て，NATを使ってマルチホームされたサイトは自身の経路をインターネットに広告しな
   くて良くなる．直感的に，これは，マルチホームをサポートしたIPv6の普及において
   も，同じ方法でこの問題を解決出来ることが確実であると思われる．

   However it is important to point out that a multihomed site
   announcing its own PI prefix(es) achieves important benefits that
   NAT-based multihoming support does not provide.  Using PI addresses,
   end-to-end communications can be preserved in face of connectivity
   failures of individual service providers, as long as the site remains
   connected through at least one operational service provider.
   Announcing PI prefixes also gives a multihomed site the ability to
   perform traffic engineering and load balancing.  While the users gain
   these benefits from PI-based multihoming, we also note that, in
   today's routing system, these gains are at the cost of the increased
   routing table size for all service providers.

   しかしながら，マルチホームされたサイトが自身のPIプレフィクスをアナウンスする
   ことは，NATによるマルチホームでは達成できない，肝心な利点があることを示すのは
   重要だろう．PIアドレスを使うと，少なくともサイトが一つのサービスプロバイダと
   の接続性が保たれている間は，個々のサービスプロバイダが停止したとしても
   end-to-endの通信が保証される．また，PIプレフィクスの広告は，トラフィックエン
   ジニアリングと負荷分散も可能にする．ユーザがPIベースのマルチホームを利用し
   て，これらの利益を得ていると言うことは，今日のルーティングシステムでは，これ
   らの利益は，全てのサービスプロバイダがルーティングテーブルサイズの増加という
   コストを負担した結果得られていると言える．

2.3.  Network Obfuscation

2.3.  ネットワークの難解析化

   Most network administrators want to hide the details of the computing
   resources, information infrastructure, and communications networks
   within their borders.  This desire is rooted in the basic security
   principle that an organization's assets are for its sole use and all
   information about those assets, their operation, and the methods and
   tactics of their use are proprietary secrets.  Some organizations use
   their information and communication technologies as a competitive
   advantage in their industries.  It is a generally held belief that
   measures must be taken to protect those secrets.  The first layer of
   protection of those secrets is preventing access to the secrets or
   knowledge about the secrets whenever possible.  It is understandable
   why network administrators would want to keep the details about the
   hosts on their network, as well as the network infrastructure itself,
   private.  They believe that NAT helps achieve this goal.

   ほとんどのネットワーク管理者は，コンピュータ資源，情報基盤，ネットワーク境界
   における通信などを秘匿したいと思っている．この要求は，組織の資産は，組織が持
   つ機器に関する全ての情報，オペレーション，操作方法であるという，基本的なセ
   キュリティの原則に基づいている．つまり，利用方法は独占的な秘密であるのだ．幾
   つかの組織は，情報と通信の技術を，その分野の競争相手より優位に保つために利用
   している．これらの秘密を保護するために，何らかの対策が施されなければならない
   というのは，一般的に信じられている事である．これらの秘密を守る第一の方法は，
   可能な限り秘匿された情報へのアクセスを防ぐ事である．ネットワーク管理者が，
   ネットワークに存在するホストや，ネットワーク基盤の情報を非公開にしたままにし
   ておきたい理由は理解できる．ネットワーク管理者はNATがこの目的を達成するための
   助けになると信じているのだ．

2.3.1.  Hiding Hosts

2.3.1.  ホストの隠蔽

   As a specific measure of network obfuscation, network administrators
   wish to keep secret any and all information about the computer
   systems residing within their network boundaries.  Such computer
   systems include workstations, laptops, servers, function-specific
   end-points (e.g., printers, scanners, IP telephones, point of sale
   machines, building door access-control devices), and such.  They want
   to prevent an external entity from counting the number of hosts on
   the network.  They also want to prevent host fingerprinting, i.e.,
   gaining information about the constitution, contents, or function of
   a host.  For example, they want to hide the role of a host, as



Thaler, et al.           Expires April 29, 2010                 [Page 5]

Internet-Draft           IPv6 NAT Considerations            October 2009


   whether it is a user workstation, a finance server, a source code
   build server, or a printer.  A second element of host fingerprinting
   prevention is to hide details that could aid an attacker in
   compromising the host.  Such details might include the type of
   operating system, its version number, any patches it may or many not
   have, the make and model of the device hardware, any application
   software packages loaded, those version numbers and patches, and so
   on.  With such information about hosts, an attacker can launch a more
   focused, targeted attack.  Operators want to stop both host counting
   and host fingerprinting.

   ネットワークの難解析化の具体策として，ネットワーク管理者は，ネットワーク境界
   より内側に在るコンピュータシステムのありとあらゆる情報を秘密にしたがってい
   る．このコンピュータシステムとは，ワークステーション，ラップトップ，サーバ
   や，プリンタ，スキャナ，IP電話，POS機器，建物内のドア管理機器などを含む．管理
   者は，外部エンティティがネットワーク上のホスト数を数え上げることを防止した
   がっている．同様に，ホストの機能や，内容，構造に関する情報を得られるような，
   ホストのフィンガープリントを取得されることも防ぎたいと思っている．例えば，管
   理者は，ホストがユーザワークステーションであるか，財務処理サーバであるか，
   ソースコードをビルドするサーバであるか，プリンタであるかなど，特定されること
   を防ぎたいと思っている．二つめの，ホストフィンガープリントの隠蔽は，ホストを
   攻撃する攻撃者の助けとなる詳細を隠すためである．これら詳細とは，OSの種類や
   バージョン，パッチがあったって居るかどうか，ハードウェアデバイスのモデル，ア
   プリケーションのインストール状況やバージョンとパッチなどその他情報を含くんで
   いる．これらの情報が得られたら，攻撃者はより明確で，対象物を絞った攻撃が行え
   るようになる．そのため，オペレータはホスト数え上げや，ホストのフィンガープリ
   ントの漏洩を防ぎたく思っている．

   Where host counting is a concern, it is worth pointing out some of
   the challenges in preventing it.  [Bellovin] showed how one can
   successfully count the number of hosts behind a certain type of
   simple NAT box.  More complex NAT deployments, e.g., ones employing
   Network Address Port Translators (NAPTs) with a pool of public
   addresses that are randomly bound to internal hosts dynamically upon
   receipt of any new connection, and do so without persistency across
   connections from the same host are more successful in preventing host
   counting.  However, the more complex the NAT deployment, the less
   likely that complex connection types like the Session Initiation
   Protocol (SIP) [RFC3261] and the Stream Control Transmission Protocol
   (SCTP) [RFC4960] will be able to successfully traverse the NAT.  This
   observation follows the age-old axiom for networked computer systems:
   for every unit of security you gain, you give up a unit of
   convenience, and for every unit of convenience you hope to gain, you
   must give up a unit of security.

   ここでホスト数え上げに関して，数え上げを防ぐ幾つかの方法を指摘することは価値
   のあることだろう．[Bellovin]は，特定の単純なNAT箱の裏側にいるホストの数を数え
   上げる方法を示した．より複雑な，例えば，新しいコネクションが生成されたとき，
   プールしているパブリックアドレスを内部ホストにランダムに割り当てるネットワー
   クアドレスポート変換(NAPTs)や，同じホストからのコネクションに恒久的なアドレス
   の割り当てを行わないような，より複雑なNATは，ホストの数え上げを防ぐ事により成
   功ている．しかしながら，より複雑なNATを用いると，SIP[RFC3261]やSCTP[RFC4960]
   などの複雑なコネクション方式をとるプロトコルがNATを越えることをほぼ出来なく
   なってしまうように思われる．これは，ネットワークコンピュータシステムに昔から
   知られている原則である．すなわち，セキュリティの向上は利便性の低下であり，利
   便性の向上はセキュリティの低下である．

   If fields such as fragment ID, TCP initial sequence number, or
   ephemeral port number are chosen in a predictable fashion (e.g.,
   sequentially), then an attacker may correlate packets or connections
   coming from the same host.

   もし，フラグメントID，TCPの初期シーケンス番号，エフェメラルポート番号などの
   フィールドが，予測可能な方法で選ばれていたなら，攻撃者は同一ホストから来るパ
   ケット，又はコネクションであるかを判別することが出来るかもしれない．

   To prevent counting hosts by counting addresses, one might be tempted
   to use a separate IP address for each transport-layer connection.
   Such an approach introduces other architectural problems, however.
   Within the host's subnet, various devices including switches,
   routers, and even the host's own hardware interface often have a
   limited amount of state available before causing communication using
   a large number of addresses to suffer significant performance
   problems.  In addition, if an attacker can somehow determine an
   average number of connections per host, the attacker can still
   estimate the number of hosts based on the number of connections
   observed.  Hence such an approach can adversely affect legitimate
   communication at all times, simply to raise the bar for an attacker.

   アドレスの数え上げによるホスト数え上げを防ぐために，それぞれのトランスポート
   層のコネクション毎に，違うIPアドレスを使いたい誘惑に狩られる．しかしながら，
   このようなアプローチはアーキテクチャ上別の問題を引き起こす．ホストのサブネッ
   ト内にある，スイッチやルータ，ホスト自身のハードウェアインターフェースさえ含
   む様々なデバイスは，しばしば制限された状態しか保持できない．そのため，大量の
   アドレスを使った通信は著しいパフォーマンスの低下を引き起こすことがある．それ
   に加え，もし攻撃者がどうやってかホスト毎のコネクション数の平均を測定できたな
   ら，攻撃者は観測したコネクション数の数をもとにして，依然としてホストの数を推
   測することが出来る．それ故，このようなアプローチは，攻撃の難度を少し上げるだ
   けで，正当な通信を阻害する効果を常に及ぼすだけである．

   Where host fingerprinting is concerned, even a complex NAT cannot
   prevent fingerprinting completely.  The way that different hosts



Thaler, et al.           Expires April 29, 2010                 [Page 6]

Internet-Draft           IPv6 NAT Considerations            October 2009


   respond to different requests and sequences of events will indicate
   consistently the type of a host that it is, its OS, version number,
   and sometimes applications installed, etc.  Products exist that do
   this for network administrators as a service, as part of a
   vulnerability assessment.

   ここでホストのフィンガープリントに関して言えば，複雑なNATでさえフィンガープリ
   ントの漏洩をを完全に防ぐことは出来ない．同じイベントに対する応答や順序が，ホ
   ストによって異なる場合，ホストのOSや，そのバージョン，場合によってはアプリ
   ケーションのインストール状況などといったホストの種類は確実に割り出されるだろ
   う．実際に，ネットワーク管理者のために，脆弱性検査の一部としてこの種の判別を
   行う製品が存在する．

   These scanning tools initiate connections of various types across a
   range of possible IP addresses reachable through that network.  They
   observe what returns, and then send follow-up messages accordingly
   until they "fingerprint" the host thoroughly.  When run as part of a
   network assessment process, these tools are normally run from the
   inside of the network, behind the NAT.  If such a tool is set outside
   a network boundary (as part of an external vulnerability assessment
   or penetration test) along the path of packets, and is passively
   observing and recording connection exchanges, over time it can
   fingerprint hosts only if it has a means of determining which
   externally viewed connections are originating from the same internal
   host.  If the NATing is simple and static, and each host's internal
   address is always mapped to the same external address and vice versa,
   the tool has 100% success fingerprinting the host.  With the internal
   hosts mapped to their external IP addresses and fingerprinted, the
   attacker can launch targeted attacks into those hosts, or reliably
   attempt to hijack those hosts' connections.  If the NAT uses a single
   external IP, or a pool of dynamically assigned IP address for each
   host, but does so in a deterministic and predictable way, then the
   operation of fingerprinting is more complex, but quite achievable.

   これらの検査ツールは，ネットワークに存在するアクセス可能なIPアドレスに対し
   て，様々な種類のコネクションを開始する．検査ツールは，ホストのフィンガープリ
   ントを完全に取得できるまで，相手先からの返信を観測し，それに対する応答を送信
   する．もし，ネットワークの検査作業の一部としてなされているのなら，通常，これ
   らツールはネットワーク内，つまりNATの内側から利用される．もし，これらツール
   が，外側からの脆弱性検査や進入検査として，パケットの通り道であるネットワーク
   境界の外側に配置され，長い期間をかけて受動的にコネクションの変化を観測し記録
   していたなら，外部的に観測された接続が同一ホストからであると決定する手段を
   持っている場合に限り，それらツールはホストのフィンガープリントを取得すること
   が出来る．もしNATが単純で静的なものであり，それぞれのホストの内側アドレスが常
   に同じ外側アドレスに変換され，逆の変換も同じような方法であったのなら，検査
   ツールは100%の確率でホストのフィンガープリントを取得できる．変換先の外側IPア
   ドレスとフィンガープリントが分かる内側ホストが得られたら，攻撃者はこれらのホ
   ストに対しより明確な攻撃，またはこれらホストに対する接続の乗っ取りを行える．
   もしNATが単一の外側IPアドレスを利用するか，またはプールされたIPアドレスをそれ
   ぞれのホストに対して動的割り当てを行うかしたときに，このような決定と予測をお
   こなったなら，フィンガープリントを得るための操作はより複雑になるが，完全に達
   成可能である．

   If the NAT uses dynamically assigned addresses, with short-term
   persistency, but no externally learnable determinism, then the
   problem gets harder for the attacker.  The observer may be able to
   fingerprint a host during the lifetime of a particular IP address
   mapping, and across connections, but once that IP mapping is
   terminated, the observer doesn't immediately know which new mapping
   will be that same host.  After much observation and correlation, the
   attacker could sometimes determine if an observed new connection in
   flight is from a familiar host.  With that information, and a good
   set of man-in-the-middle attack tools, the attacker could attempt to
   compromise the host by hijacking a new connection of adequately long
   duration.  If temporal persistency is not deployed on the NAT, then
   this tactic becomes almost impossible.  As the difficulty and cost of
   the attack increases, the number of attackers attempting to employ it
   decreases.  And certainly the attacker would not be able to initiate
   a connection toward a host for which the attacker does not know the
   current IP address binding.  So the attacker is limited to hijacking
   observed connections thought to be from a familiar host, or to
   blindly initiating attacks on connections in flight.  This is why
   network administrators appreciate complex NATs' ability to deter host
   counting and fingerprinting, but such deterrence comes at a cost of



Thaler, et al.           Expires April 29, 2010                 [Page 7]

Internet-Draft           IPv6 NAT Considerations            October 2009


   host reachability.

   もしNATが動的アドレスの割り当てをしており，その期間が短期間であり，外部から
   フィンガープリントを決定するための学習が出来なかった場合，攻撃はより難しくな
   る．観測者は複数の接続にわたって，特定のIPアドレスが有効である期間中，ホスト
   のフィンガープリントを取得することが出来るかも知れない．しかし，ひとたびIPア
   ドレスのマッピングが終了すると，観測者は，どの新しいマッピングが同じホストか
   らのもであるか即座に知ることが出来ない．多くの観測と相関に関する情報を得た
   後，攻撃者は観測中の新たな接続が，同一ホストからのものであると時々決定できる
   ようになる．これらの情報と中間者攻撃のツールを使えば，攻撃者は十分な期間，新
   たな接続を乗っ取る事が出来るようになる．もしアドレスの短時間割り当て機能がNAT
   に無い場合，この防御法はほぼ不可能となる．攻撃の難しさととコストが増えるにし
   たがって，このような攻撃を行う攻撃者は減少すし，そして確実に，攻撃者が現在の
   IPアドレスの割り当てを知らないホストに対して接続を開始する事は出来なくなるだ
   ろう．そのため，攻撃者が同一ホストからと思われる接続を乗っ取ること，もしく
   は，やみくもに接続を開始する攻撃は制限されることになる．これが，ホストの数え
   上げとフィンがプリント取得から守るために，ネットワーク管理者が複雑なNATの動作
   を評価する理由である．しかしながら，これらの防御法はホストへの接続性を損なう
   というコストがかかる．

2.4.  Topology Hiding

2.4.  トポロジ隠蔽

   It is perceived that a network operator may want to hide the details
   of the network topology, the size of the network, the identities of
   the internal routers, and the interconnection among the routers.
   This desire has been discussed in [RFC4864] Sections 4.4 and 6.2.

   ネットワーク管理者がネットワークトポロジ，ネットワークの大きさ，内部ルータ，
   ルータ間の連携などの詳細を隠蔽したがるのは理解できることである．この要求につ
   いては，[RFC4864]の4.4と6.2節で議論されている．

   However the success of topology hiding is dependent upon the
   complexity, dynamism, and pervasiveness of bindings the NAT employs
   (all of which were described above).  The more complex, the more the
   topology will be hidden, but the less likely that complex connection
   types will successfully traverse the NAT barrier.  Thus the trade-off
   is reachability across applications.

   しかしながら，トポロジ隠蔽の成功は，前述したNATのアドレス割り当ての複雑さ，ア
   ドレスの変化の度合い，およびその普及に依存している．より複雑であれば，よりト
   ポロジは隠蔽されるだろう．しかし，そのような複雑な種類の接続はNAT越えを阻害す
   るように思われる．したがって，これはアプリケーションとの接続性に関してトレー
   ドオフとなっていると言える．

   Even if one can hide the actual addresses of internal hosts through
   address translation, this does not necessarily prove sufficient to
   hide internal topology.  It may be possible to infer some aspects of
   topological information from passively observing packets.  For
   example, based on packet timing, delay measurements, the Hop Limit
   field, or other fields in the packet header, one could infer the
   relative distance between multiple hosts.  Once an observed session
   is believed to match a previously fingerprinted host, that host's
   distance from the NAT device may be learned, but not its exact
   location or particular internal subnet.

   たとえ，内部ホストの実際のアドレスを，アドレス変換により隠蔽できたとしても，
   必ずしも内部トポロジを隠蔽するのに十分であるとは言えない．受動的にパケットを
   観測することで，トポロジ情報の幾つかの側面を推測することは可能だろう．例え
   ば，パケットのタイミング，ディレイの計測，ホップ制限フィールドやその他のパ
   ケットフィールドなどをもとに，複数ホスト間の相対的な距離を推測できる．ひとた
   び，観測されたセッションが，以前に得たホストのフィンガープリントと一致したな
   ら，ホストからNATまでの距離が判明する．しかし，正確な位置または内部サブネット
   の特定は出来ない．

   Host fingerprinting is required in order to do a thorough distance
   mapping.  An attacker might then use message contents to lump certain
   types of devices into logical clusters, and take educated guesses at
   attacks.  This is not, however, a thorough mapping.  Some NATs change
   the TTL hop counts, much like an application-layer proxy would, while
   others don't; this is an administrative setting on more advanced
   NATs.  The simpler and more static the NAT, the more possible this
   is.  The more complex and dynamic and non-persistent the NAT
   bindings, the more difficult.

   ホストのフィンガープリント取得は，完璧な距離のマッピングを計測するために必要
   とされる．次に，攻撃者はメッセージの中身を利用して特定のデバイスを論理的にク
   ラスタリングし，攻撃時に経験に基づいた推測を行うだろう．しかしこれは，完璧な
   距離のマッピングでは無い．いかつかのNATは，アプリケーション層のプロクシが行う
   ように，TTLのホップカウントを書き換える(ただしこれは，より高機能なNATの管理
   者設定である)．より単純で静的なNATでは，マッピングを完全にすることはより簡単
   となる．より複雑で，動的で一時的なアドレス割り当てを行うNATの場合，より難しく
   なる．

2.5.  Summary Regarding NAT as a Tool for Network Obfuscation

2.5.  ネットワークの難解析化ツールとしてのNAT関連のまとめ

   The degree of obfuscation a NAT can achieve will be a function of
   its complexity as measured by:
   o  The use of one-to-many NAPT mappings;
   o  The randomness over time of the mappings from internal to external
      IP addresses, i.e., non-deterministic mappings from an outsider's
      perspective;
   o  The lack of persistence of mappings, i.e., the shortness of
      mapping lifetimes and not using the same mapping repeatedly;


Thaler, et al.           Expires April 29, 2010                 [Page 8]

Internet-Draft           IPv6 NAT Considerations            October 2009


   o  The use of re-writing in IP header fields such as TTL.

   以下のように測定されるように，NATが実現できる難解析化の度合いはNATの複雑さの
   関数となるだろう．
   o  一対多のNAPTマッピング
   o  内部から外部のIPアドレス変換の時間経過によるランダム性．すなわち，外から見
      た場合の非決定的なマッピング
   o  マッピングの非永続性．すなわち，マッピング時間の短さと，同じマッピングを繰
      り返し利用
   o  TTLといった，IPヘッダフィールドの書き換え

   However, deployers be warned: as obfuscation increases, host
   reachability decreases.  Mechanisms such as STUN [RFC5389] and Teredo
   [RFC4380] fail with the more complex NAT mechanisms.

   しかしながら，利用者は次の点に注意する必要がある．難解析化度合いが強くなる
   と，ホストへの到達性は失われる．STUN [RFC5389]とToredo [RFC4380]は，より複雑
   なNAT機構はの下では動作しない．

2.6.  Simple Security

2.6.  単純なセキュリティ

   It is commonly perceived that a NAT box provides one level of
   protection because external hosts cannot directly initiate
   communication with hosts behind a NAT.  However one should not
   confuse NAT boxes with firewalls.  As discussed in [RFC4864] Section
   2.2, the act of translation does not provide security in itself, but
   rather the lack of pre-established or permanent filtering state.  The
   stateful filtering function can provide the same level of protection
   without requiring a translation function.  For further discussion,
   see [RFC4864] Section 4.2.

   外部にあるホストは，NAT下にあるホストと直接通信を開始出来ないので，NAT箱は単
   純なセキュリティ機能を持つとの共通認識がある．しかしながら，NAT箱とファイア
   ウォールを混同すべきではない．[RFC4864]の2.2節で議論されているように，変換自
   体には本来セキュリティ機能は無く，むしろ事前確立もしくは恒久的なフィルタリン
   グ状態を欠いてしまっている．ステートを持つフィルタリング機構は，アドレス変換
   無しで同じレベルの防御を可能とする．より詳細な議論が知りたければ，[RFC4864]の
   4.2節を参照されたい．

2.7.  Discussion

2.7.  議論

   At present, the primary benefits one may receive from deploying NAT
   appear to be avoiding renumbering and facilitating multihoming
   without impacting routing scalability.

   目下，NATを利用することによって得られる第一の利点は，アドレスの再設定を回避で
   きるという点と，ルーティングの規模追従性に影響を及ばずにマルチホーム出来ると
   いう点である．

   Network obfuscation (host hiding, both counting and fingerprinting
   prevention, and topology hiding) may well be achieved with more
   complex NATs, but at the cost of losing some reachability and
   application success.  Again, when it comes to security, this is often
   the case: to gain security one must give up some measure of
   convenience.

   ホスト隠蔽，ホスト数え上げやフィンガープリントの取得からの防御，トポロジ隠蔽
   といった，ネットワークの難解析化はより複雑なNATを使うと達成される．しかし，ホ
   ストへの到達性とアプリケーションの接続性が失われるというコストもかかってしま
   う．繰り返すが，セキュリティの向上は利便性の低下へと繋がる．

3.  Architectural Considerations of IPv6 NAT

   First it is important to distinguish between the effects of a NAT box
   vs. the effects of a firewall.  A firewall is intended to prevent
   unwanted traffic [RFC4948] without impacting wanted traffic, whereas
   a NAT box also interferes with wanted traffic.  In the remainder of
   this section, the term "reachability" is used with respect to wanted
   traffic.

   The discussions on IPv6 NAT often refer to the wide deployment of
   IPv4 NAT, where people have both identified tangible benefits and
   gained operational experience.  However the discussions so far seem
   mostly focused on the potential benefits that IPv6 NAT may, or may
   not, bring.  Little attention has been paid to the bigger picture, as
   we elaborate below.




Thaler, et al.           Expires April 29, 2010                 [Page 9]

Internet-Draft           IPv6 NAT Considerations            October 2009


   When considering the benefits that IPv6 NAT may bring to a site that
   deploys it, we must not overlook a bigger question: if one site
   deploys IPv6 NAT, what is the potential impact it brings to the rest
   of the Internet that does not do IPv6 NAT?  This important question
   does not seem to have been addressed, or addressed adequately.

   We believe that the discussions on IPv6 NAT should be put in the
   context of the overall Internet architecture.  The foremost question
   is not how many benefits one may derive from using IPv6 NAT, but more
   fundamentally, whether a significant portion of parties on the
   Internet are willing to deploy IPv6 NAT, and hence whether we want to
   make IP address translation a permanent block in the Internet
   architecture.

   One may argue that the answers to the above questions depend on
   whether we can find adequate solutions to the renumbering and
   multihoming problems.  It is worthwhile pointing out that IPv6 NAT is
   not the only solution to these two problems.  Renumbering can be
   avoided by allocating to users provider-independent addresses.
   Multihoming is already a pervasive practice today, not some new
   feature to be supported in the future, and NAT-based multihoming has
   serious limitations as discussed earlier.  The real issue is not
   multihoming per se, but the need for a scalable routing system.

   If the answer to the above two questions is no, then non-IPv6-NAT
   parts of the world should *not* be affected by those sites that want
   to deploy IPv6 NAT.  More specifically, IPv6 users should be able to
   reach each other directly without having to worry about address
   translation boxes between the two ends.  IPv6 application developers
   in general should be able to program based on the assumption of end-
   to-end reachability (of wanted traffic), without having to address
   the issue of traversing NAT boxes.  For example, referrals and multi-
   party conversations are straightforward with end-to-end addressing,
   but vastly complicated in the presence of address translation.
   Similarly, network administrators should be able to run their
   networks without the added complexity of NATs, which can bring not
   only the cost of additional boxes, but also increased difficulties in
   network monitoring and problem debugging.

   Given the diversity of the Internet user populations and the
   diversity in today's operational practice, it is conceivable that
   some parties may have a strong desire to deploy IPv6 NAT, and the
   Internet should accommodate different views that lead to different
   practices (i.e., some using IPv6 NAT, others not).

   If we accept the view that some, but not all, parties want IPv6 NAT,
   then the real debate should not be on what benefits IPv6 NAT may
   bring to the parties who deploy it.  It is undeniable that network



Thaler, et al.           Expires April 29, 2010                [Page 10]

Internet-Draft           IPv6 NAT Considerations            October 2009


   address translation can bring certain benefits to its users.
   However, the real challenge we should address is how to design IPv6
   NAT in such a way that it can hide its impact within some localized
   scope.  If IPv6 NAT design can achieve this goal, then the Internet
   as a whole can strive for (re-installing) the end-to-end reachability
   model.


4.  Solution Space

   From an end-to-end perspective, the solution space for renumbering
   and multihoming can be broadly divided into three classes:

   1.  Endpoints get a stable, globally reachable address: In this class
       of solutions, end sites use provider-independent addressing and
       hence endpoints are unaffected by changing service providers.
       For this to be a complete solution, provider-independent
       addressing must be available to all managed networks (i.e., all
       networks that use manual configuration of addresses or prefixes
       in any type of system).  However, in today's practice, assigning
       provider-independent addresses to all networks, including small
       ones, raises concerns with the scalability of the global routing
       system.  This is an area of ongoing research and experimentation.
       In practice, network administrators have also been developing
       short-term approaches to resolve today's gap between the
       continued routing table growth and limitations in existing router
       capacity [NANOG].
   2.  Endpoints get a stable but non-globally-routable address on
       physical interfaces but a dynamic, globally routable address
       inside a tunnel: In this class of solutions, hosts use locally-
       scoped (and hence provider-independent) addresses for
       communication within the site.  As a result, managed systems such
       as routers, DHCP servers, etc. all see stable addresses.
       Tunneling from the host to some infrastructure device is then
       used to provide the host with globally routable addresses which
       may change, but address changes are constrained to systems that
       operate over or beyond the tunnel, including DNS servers and
       applications.  These systems, however, are the ones that often
       can already deal with changes today using mechanisms such as DNS
       dynamic update.  However, if endpoints and the tunnel
       infrastructure devices are owned by different organizations, then
       solutions are harder to incrementally deploy due to the incentive
       and coordination issues involved.
   3.  Endpoints get a stable address which gets translated in the
       network: In this class of solutions, end sites use non-globally-
       routable addresses within the site, and translate them to
       globally routable addresses somewhere in the network.  In
       general, this causes the loss of end-to-end transparency which is



Thaler, et al.           Expires April 29, 2010                [Page 11]

Internet-Draft           IPv6 NAT Considerations            October 2009


       the subject of [RFC4924] and the documents it surveys.  If the
       translation is reversible, and the translation is indeed reversed
       by the time it reaches the other end of communication, then end-
       to-end transparency can be provided.  However if the two
       translators involved are owned by different organizations, then
       solutions are harder to incrementally deploy due to the incentive
       and coordination issues involved.

   Concerning routing scalability, although there is no immediate
   danger, routing scalability has been a long time concern in
   operational communities, and an effective and deployable solution
   must be found.  We observe that the question at hand is not about
   whether some parties can run NAT, but rather, whether the Internet as
   a whole would be willing to rely on NAT to curtail the routing
   scalability problem, and whether we have investigated all the
   potential impacts of doing so to understand its cost on the overall
   architecture.  If effective solutions can be deployed in time to
   allow assigning provider-independent IPv6 addresses to all user
   communities, the Internet can avoid the complexity and fragility and
   other unforeseen problems introduced by NAT.

4.1.  Discussion

   As [RFC4924] states:
      A network that does not filter or transform the data that it
      carries may be said to be "transparent" or "oblivious" to the
      content of packets.  Networks that provide oblivious transport
      enable the deployment of new services without requiring changes to
      the core.  It is this flexibility that is perhaps both the
      Internet's most essential characteristic as well as one of the
      most important contributors to its success.

   We believe that providing end-to-end transparency, as defined above,
   is key to the success of the Internet.  While some fields of traffic
   (e.g., Hop Limit) are defined to be mutable, transparency requires
   that fields not defined as such arrive un-transformed.  Currently,
   the source and destination addresses are defined as immutable fields,
   and are used as such by many protocols and applications.

   Each of the three classes of solution can be defined in a way that
   preserves end-to-end transparency.  We strongly encourage the
   community to consider end-to-end transparency as a requirement when
   proposing any solution, whether it be based on tunneling or
   translation or some other technique.  Solutions can then be compared
   based on other aspects such as scalability and ease of deployment.






Thaler, et al.           Expires April 29, 2010                [Page 12]

Internet-Draft           IPv6 NAT Considerations            October 2009


5.  Security Considerations

   Section 2 discusses potential privacy concerns as part of the Host
   Counting and Topology Hiding problems.


6.  IANA Considerations

   [RFC Editor: please remove this section prior to publication.]

   This document has no IANA Actions.


7.  IAB Members at the time of this writing

   Marcelo Bagnulo
   Gonzalo Camarillo
   Stuart Cheshire
   Vijay Gill
   Russ Housley
   John Klensin
   Olaf Kolkman
   Gregory Lebovitz
   Andrew Malis
   Danny McPherson
   David Oran
   Jon Peterson
   Dave Thaler


8.  References

8.1.  Normative References

8.2.  Informative References

   [Bellovin]
              Bellovin, S., "A Technique for Counting NATted Hosts",
              Proc. Second Internet Measurement Workshop ,
              November 2002,
              <http://www.cs.columbia.edu/~smb/papers/fnat.pdf>.

   [I-D.carpenter-renum-needs-work]
              Carpenter, B., Atkinson, R., and H. Flinck, "Renumbering
              still needs work", draft-carpenter-renum-needs-work-04
              (work in progress), October 2009.

   [NANOG]    "Extending the Life of Layer 3 Switches in a 256k+ Route



Thaler, et al.           Expires April 29, 2010                [Page 13]

Internet-Draft           IPv6 NAT Considerations            October 2009


              World", NANOG 44 , October 2008, <http://www.nanog.org/
              meetings/nanog44/presentations/Monday/
              Roisman_lightning.pdf>.

   [RFC3041]  Narten, T. and R. Draves, "Privacy Extensions for
              Stateless Address Autoconfiguration in IPv6", RFC 3041,
              January 2001.

   [RFC3261]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", RFC 3261,
              June 2002.

   [RFC4380]  Huitema, C., "Teredo: Tunneling IPv6 over UDP through
              Network Address Translations (NATs)", RFC 4380,
              February 2006.

   [RFC4864]  Van de Velde, G., Hain, T., Droms, R., Carpenter, B., and
              E. Klein, "Local Network Protection for IPv6", RFC 4864,
              May 2007.

   [RFC4924]  Aboba, B. and E. Davies, "Reflections on Internet
              Transparency", RFC 4924, July 2007.

   [RFC4948]  Andersson, L., Davies, E., and L. Zhang, "Report from the
              IAB workshop on Unwanted Traffic March 9-10, 2006",
              RFC 4948, August 2007.

   [RFC4960]  Stewart, R., "Stream Control Transmission Protocol",
              RFC 4960, September 2007.

   [RFC5389]  Rosenberg, J., Mahy, R., Matthews, P., and D. Wing,
              "Session Traversal Utilities for NAT (STUN)", RFC 5389,
              October 2008.


Authors' Addresses

   Dave Thaler
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA  98052
   USA

   Phone: +1 425 703 8835
   Email: dthaler@microsoft.com





Thaler, et al.           Expires April 29, 2010                [Page 14]

Internet-Draft           IPv6 NAT Considerations            October 2009


   Lixia Zhang
   UCLA Computer Science Department
   3713 Boelter Hall
   Los Angeles, CA  90095
   USA

   Phone: +1 310 825 2695
   Email: lixia@cs.ucla.edu


   Gregory Lebovitz
   Juniper Networks, Inc.
   1194 North Mathilda Ave.
   Sunnyvale, CA  94089
   USA

   Email: gregory.ietf@gmail.com


































Thaler, et al.           Expires April 29, 2010                [Page 15]
